---
title: "Oilwell Production and Completion Regression Analysis"
author: "Tom Wilson"
date: "November 24, 2018"
output: pdf_document
bibliography: references.bib

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Literature Review

<!-- 
*Total length of literature review should be about 4 single-spaced pages or more (not counting the references page.)*

*Documented in APA style, with section headings for major sections as well as subtopics*
-->

## Introduction

For centuries, oilwells have been drilled vertically and completed by perforation only.  Since the invention of horizontal drilling in the late 20th century, literature has shown that various completion parameters have a significant effect on oil production.  Multiple recent sources agree that there is value in leveraging available data as input to statistical models steeped in machine learning.[@fulks2016optimizing], [@holdaway2015drilling], [@pankaj2018need], [@subrahmanya2014advanced] While there is some disagreement about the limitations and applicability of such models, most agree that a general data anlysis workflow is applicable.  [@fulks2016optimizing],[@temizel2015efficient],[@groulx2017multivariate], [@pankaj2018need] 

<!-- 
Using relevant headings, the body should be composed of sections.  
They take up each issue one at a time and discuss how the authors of the articles respond to that issue.  

Don’t forget to introduce and close each section with a sentence focused on the literature (topic sentence and concluding sentence.)

Length of body: about 3 pages or more, single-spaced.  (Length of each section will vary, but each typically contains several paragraphs.)
 -->

## Data Quality
One recurring theme within recent literature related to oilwell completion is that of data quality.  @lopes2017mind takes a statistical approach to dealing with gaps in data by breaking synthesysing gaps in otherwise complete data.  @lopes2017mind eventually shows that gaps in data did not have a significant effect on model selection or accuracy.  On the other hand, @wang2016propagation claims that a input uncertainties model selection challenges were primarily caused by missing data and noise.  @khodabakhsh2017cloud took yet another approach via real–time models for detecting and classifying errors.  @wang2016propagation suggests Basis Pursuit Denoising (BPDN) as a solution to data quality issues.  Other sources did not comment on dealing with data quality or noise.  

## General Workflow
Regardless of the target variable or underlying dataset, there is wide-spread agreement that data analysis workflows are generally applicable and value-added.  Quoting from @holdaway2015drilling: "Data-driven workflows, models, and analysis can address a diverse array of business problems in the oil and gas industry." @groulx2017multivariate found that their approach applied equally well to all basins(a geologic formation) and plays(oil barring zone) available.  @groulx2017multivariate showed that, generally, the number of performance measures directly correlate with the number of patterns identified.  @groulx2017multivariate indicates that Parallel coordinates approach makes identification of thresholds and correlation windows easy.  Which can be valuable input for other regression efforts.  Furthermore, the predictive proxy approach has a wide variety of applications to completion engineering and management.  [@pankaj2018need] Drilling and lifting in addition to completion also benefit from faster decision making according to @pankaj2018need.  @khodabakhsh2017cloud agrees that the data analytic approach is applicable to the oil drilling industry in addition to oilwell completion practices.  @subrahmanya2014advanced demonstrates that machine learning methods show considerable promise.  @guevara2017datadriven was able to
outperform conventional techniques, such as kriging (a gaussian interpolation method).  Future work in other domains was suggested by a variety of authors: vertical well logs [@guevara2017datadriven], geophysical [@zhang2018mining], fluid dynamics [@ezzatabadipour2017deep], exploration [@Jahromi2017overview], Remote sensing [@Jahromi2017overview], geobotany and geochemistry [@Jahromi2017overview].
There is genuine excitement surrounding the application of machine learning and data analytics to various topics related to oil and gas production.

## Feature Importance
Each author provides some insight into what features are most important for predicting oil production accurately.  As a default position; High proppant (sand or other particulates used to prop open fractures in rock under high pressure), high-fluid (usually water, but sometimes gelling or cross-linking additives are included) completion designs described by @fulks2016optimizing have shown success every basin.  @fulks2016optimizing goes on to say that degradable diversion (poly lactic acid diverts pressure but eventually degrades by bacteria) improves cluster efficiency and optimal lateral landing zone are important.  In contrast, @temizel2015efficient lists in order of importance fracture half-length (which could be related to diversion), proppant amount, zone coverage (nearly equivalent to landing zone), and slurry volume (slurry is the combination of fluid with proppant).  @ezzatabadipour2017deep is more interested in two-phase flow patterns as a function of pipe condition.  @zhang2018mining purports that chemical ingredients are conducive to production and some, in fact, negatively impact gas production.  [@zhang2018mining] @lopes2017mind includes rock and fluid properties.  While @guevara2017datadriven expects to add well completion parameters to their model.  @Jahromi2017overview provides structural geology and reservoir properties (fault lines, water zones, etc.) as important features.  @wang2016propagation focuses on trap and peel heights as well as gas flux, plans to add droplet size and gas-oil ratio to that list.  

## Simulation
Another common thread among recent literature is the idea of simulating new data from predictive models.  @temizel2015efficient sees simulations as a tool to determine not only feature importance and significance, but also effect direction.  @temizel2015efficient goes on to say that simulations can replace commercial fracture simulators.  The approach described in @pankaj2018need creates a "parametric explosion of parameters"; enabling optimal well completion design to be determined much faster than with traditional methods, a matter of minutes instead of months.[@pankaj2018need].@bozoev2016selection agrees that simulation tends to be an appropriate approach to choosing the optimum completion of the wellbore.  Like-wise, @ezzatabadipour2017deep notes that investigations could be improved by exhaustive searches.  @wang2016propagation also observes that resorting to simulated data from very high-resolution numerical simulations is a good compromise.  @liu2018relationship uses simulation to study early hydration stages of a cement slurry which effect the transmission of hydrostatic pressure.


## Model Limitations
Though there is much fanfare surrounding data analytic approaches applied to oilwell completions, many authors note that there are limitations to such endeavors.  @fulks2016optimizing says that establishing baseline performance is necessary.  @temizel2015efficient takes the stance taht conclusions from data driven models are specific to the model used.  Careful consideration is necessary for normalizing both performance measures and inputs.  Before discernible conclusions, patterns detected must be reviewed to refine insights.  [@groulx2017multivariate] @pankaj2018need notes on that a calibrated model is fundamental to a reliable prediction.  @bozoev2016selection has concern that analytical approaches do not take into account interference effects.  @wang2016propagation adds that next stage numerical models must be able to handle mixtures of oil and gas in order to simulate realistically.


## Conclusion
For centuries, oilwells have been drilled vertically with little care about completion.  Today, horizontal drilling has changed that.  literature shows completion parameters have a significant effect on oil production.  And that these parameters can be used to make accurate predictions.  While there is some disagreement about the limitations and applicability of such models, most agree that a general data analysis workflow is applicable.  

# Regression Analysis



## Introduction
<!--  briefly refresh the reader's mind as to the variables of interest -->
Welldatabase is an aggregator of publically available data related to oil and gas production. Many states have an entity responsible for collecting and enforcing reporting requirements which vary between juisdictions. In Texas, for example, Texas Railroad Commision (TXRRC) regulates the oil and gas industry. Location and depth of well casing is tightly regulated. TXRCC requires all hydocarbon production that leaves the well site to be reported monthly. In the state of texas, oil wells are tested for once per year. This analysis will focus on two counties in west texas, Midland County and Pecos County. Our goal is to model 12 month cumulative oil production as a function of publically available drilling and completion parameters summarized in the following table.

<!-- Use at least 4 explanatory variables -->

| column name | description | units
|-------------|-------------|-------
|api | 14 digit unique well identifier | STATE-COUNTY-UWID-STID
|surfacelatitude | surface location | degrees
|surfacelongitude | surface location | degrees
|county | texas county | either Midland or Pecos
|producingformation | oil production geologic formation | e.g Wolfcamp, Spraberry
|wellboreprofile | type of drilling  | Verical, Directional, or Horizontal
|trueverticaldepth  |  depth of production casing | feet
|laterallength  |  legth of horizontal component of well | feet
|totalbasewatervolume | volume of water used durring hydrolic fracturing | gallons
|totalproppantmass  |  mass of sand used to prevent closure of fractures | lbs
|fluidsystem  |  type of fluid additives | one of slick-water, linear, or  cross-link 
|surfactantpresent  |  weather or not sufactant was used during completion | True or False
|scaleinhibitorpresent  | wether or not scale inhibtors were used during completion | True or False   
|claycontrolpresent |  weather or not clay control was used during completion | True or False
|acidtreatmentpresent |  weather or not acid was used during completion | True or False
|chokesize  |  open proportion of surface gate valve during well test | 0 is closed, 1 is open
| oil       |  first 12 month cumulative oil production | bbl 


## Preprocessing
each table of welldatabase must be summarize and deduplicate by api number then joined to the header on api where wellboreprofile=HORIZONTAL. The python code for this processing is available on [github](https://www.github.com/wilsonfigy/AppliedRegression/master/)

## No auto-correlation
It is tempting to use the reported monthly oil production as is, but that would lead to a target variable that is highly auto-correlated, that is the previous month's production is a good esitmate of the next month. For this reason, we will focus our effort on modeling cumulative oil production.

## Linear Relationship
<!-- do a log transformation? -->

oil is not very not very linear
log(oil)
chokesize

## Little Multicollinearity
<!-- Are any of the explanatory variables highly correlated? -->
totalpropantmass and totalfracmass and totalbasewatervolume are highly correlated

## Multivariate Normality
totalproppantmass has too many zeros
set totalproppantconcetration=0 to null
totalproppantconcetration = totalproppantmass/totalbasewatervolume


## The regression model

<!-- create a pairs plot on the explanatory and response variables. -->

<!-- Is there any reason to fit a quadratic term? -->
It is expected that the relationship between these predictors and oil production is highly non-linear so it is appropriate to consider high degree polynomials with interations and quadradic terms.

![]('./images/hw2part3-2.png')

<!-- Fit your model. Include quadratic, log, or interaction terms as you see fit. -->

<!-- Interpret your beta coefficients to the best of your ability. -->

<!-- Are your coefficients significant? -->

<!-- Use the F test to compare two nested models. The smaller model should have at least 2 fewer variables than the larger model. -->

<!-- Report the R2 and Adjusted-R2 values. -->

<!-- Comment on the fit of the model as determined by how much variability is explained. -->

<!-- Is this a guarantee that the model will accurately describe the population? -->



## Homoscedasticity


## Residual Analysis
<!--
### Use plots to get an idea of which points may be contributing to the fit.
### Consider re-fitting a model with and without certain data that have both high leverage and large residuals.
** Do not include every plot, but consider including plots that give the reader an idea of your analysis. **

## interpretation of the model that makes sense.
### Why do you think some variables stayed significant and others dropped out?
### Are any of your variables highly correlated
### Give CIs for a mean predicted value and a future predicted value for at least one combination of X's (from your final generalized linear model).
-->

## Summary
<!--
### Count the number of total hypothesis tests that you ran (including all the ones you didn't include in the report). Call that number m. If you multiplied every single p-value in this report by that number, would any of your conclusions / analyses have fundamentally changed? Which ones? How?
-->

# References

<!-- 
# Format
* Word or pdf
* Only include code that is interesting to the reader.
* Do not print lists of data.
* If you are commenting on the significance of a variable in your text, you should report the p-value.
* Residuals determine model appropriateness, not p-values or R2.
* Summarize any output from R; do not include technical calculations. 
* Use complete sentences.
* Make sure sections flow nicely into one another. 
* Remember to label all graphs.
-->
